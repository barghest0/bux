version: "3.8"
services:
  user:
    build: ./services/user
    container_name: user-service
    depends_on: [postgres]
    restart: always
    environment: [CONFIG_PATH=/app/config/local.yaml]
    ports: [8081:8081]
    networks: [bux]
    volumes: [./services/user/config/local.yaml:/app/config/local.yaml]
    develop:
      watch:
        - action: rebuild
          path: ./services/user
          target: /app
  transaction:
    build: ./services/transaction
    container_name: transaction-service
    depends_on: [postgres]
    restart: always
    environment: [CONFIG_PATH=/app/config/local.yaml]
    ports: [8082:8082]
    networks: [bux]
    volumes: [./services/transaction/config/local.yaml:/app/config/local.yaml]
    develop:
      watch:
        - action: rebuild
          path: ./services/transaction
          target: /app
  postgres:
        image: postgres:16
        container_name: postgres
        restart: always
        environment:
          POSTGRES_USER: postgres
          POSTGRES_PASSWORD: barghest
          POSTGRES_DB: postgres
        ports: [5432:5432]
        volumes: [pgdata:/var/lib/postgresql/data, ./init:/docker-entrypoint-initdb.d]
        networks: [bux]
  pgadmin:
        container_name: pgadmin
        image: dpage/pgadmin4
        restart: always
        environment:
            PGADMIN_DEFAULT_EMAIL: barghest391@gmail.com
            PGADMIN_DEFAULT_PASSWORD: barghest
        networks: [bux]
        ports: [5050:80]
        depends_on: [postgres]

networks:
  bux:
    driver: bridge

volumes:
  pgdata:
  pgadmin-data:
